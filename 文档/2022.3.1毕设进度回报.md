# 毕设进度回报

## 2022.2.28

#### 1、开发容器环境配置

购买检索合适的配置的服务器，并且完成服务器开发配置，包括开发环境、安装数据库；然后配置windows远程SSH连接的环境、连接Git仓库等。

#### 2、修改开题报告的一些小细节

各层代码的模块划分与具体实现方案

**爬虫**

初始化模块：初始化读取服务的配置文件、包括爬取间断时间、需要爬取的各个网站url以及登录账户密码等配置信息

爬取模块：对传入url进行爬取并返回爬取信息

url管理模块：初始化读入url，并且持续判断是否有还可以爬取的url

解析模块：对对应的url进行解析、获取有效信息，并调用特征模块将每个电影的特征划分出来，然后其对应的所有特征作为key传给DAO模块，然后获取原本的数据，反序列化，再写入当前电影id，再序列化，调用DAO存回数据库。

调度模块：按照逻辑调度以上模块，使之在服务器持续运行

**DAO**

只与数据库进行交接

存储模块：将爬虫的解析模块得到的数据以key-value的形式存储到数据库。

读取模块：读取对应key的数据，将其交给特征模块处理

**数据库**

使用Redis，原因是Redis具备性能优势，这边存储形式都是使用key-value，key为tag_id（string）、value（结构体中的多个电影id的list、网站id、网站打分等信息序列化进行序列化后的string），这样其读取和存储效率会有很大程度的提升，响应速度会非常快，因为只需要寻找一级key的结果，在外部程序进行序列化和反序列化。

**存储信息暂定**

**key**

```c++
string tag_id; // 特征id 
```

tag_id

**value**

```protobuf
syntax = "proto3";

message film_info {
  int64 film_id = 1;          // 电影id
  int64 web_id = 2;           // 网站id
  int64 web_score = 3;        // 网站的打分
  int64 web_full_score = 4;   // 网站的满分
}

message tag_films {
  // 该key下对应的所有电影信息
  repeated film_info film_infos = 1;
}
```

tag_films序列化后的string

**特征**

上报模块：将爬虫的解析模块获取的有效信息进行特征获取。
特征获取模块：调用DAO层读取模块获取对应特征id的电影信息。

**序列化与反序列化**

使用protobuf协议，自动生成结构体的序列化和反序列化函数

对底层电影各级信息通过一定方法完成序列化成string和反序列化到原来的结构体。

**配置文件**

用于热更新，快捷修改各个可能人工变更的数据，修改配置文件后重启服务即可生效

暂定配置信息包括：爬虫间断时间、各个网站url、网站登录的账户密码、网站权重占比等

**虫洞消费、索引**

消费前端的请求、得到请求包，解析出请求包的tag，通过DAO层将tag作key的数据从数据库获取出来，调取特征层的特征获取模块得到各个电影信息，传给排序层。

**排序**

读取配置文件中每个网站的权重百分比，然后通过对应value存储的网站id得到权重，再得到各个网站的打分，以一定算法得到排序分，再进行排序，然后将结果传给前端。

暂定电影排序依据分数计算：<网站权重百分比> \* <网站得分> / <网站满分> \* 100.0

**前端**

完成ui设计、比如标题、按钮、展示结果等的美化，并且完成对应按钮的请求上报与信息获取等，这部分需求暂时留到最后再开发，目前安排还没有很详细。

**用户历史去重**

Redis布隆过滤器

二进制存储结构，效率高，使用多个hash算法

优势在于，相对于其他数据库，如果使用比如DCache，他没有自带这个模块，就需要自己实现，然后每次修改的时候都需要拿出来，修改，再放回去，使用redis的话，它自带一个布隆过滤器模块，我们只需要直接对他进行修改，这样减弱了数据库的负担
